
// import jakarta.servlet.http.HttpSession;

// @Controller
// @RequestMapping("/quiz")
// public class QuizController {

//     @Autowired
//     private QuizRepository quizRepository;

//     @SuppressWarnings("unused")
//     @Autowired
//     private UserRepository userRepository;

//     @Autowired
//     private LeaderboardRepository leaderboardRepository;

//     // Show quiz page
//     @GetMapping("/{id}")
//     public String showQuiz(@PathVariable Long id, Model model, HttpSession session) {
//         Quiz quiz = quizRepository.findById(id)
//                 .orElseThrow(() -> new RuntimeException("Quiz not found"));

//         User user = (User) session.getAttribute("user");
//         if (user == null) {
//             return "redirect:/login";
//         }

//         model.addAttribute("quiz", quiz);
//         return "quiz"; // quiz.html template
//     }

//     // Handle quiz submission
//     @PostMapping("/{id}/submit")
//     public String submitQuiz(@PathVariable Long id,
//             @RequestParam int score,
//             @RequestParam int totalMarks,
//             HttpSession session,
//             Model model) {

//         User user = (User) session.getAttribute("user");
//         if (user == null) {
//             return "redirect:/login";
//         }

//         Quiz quiz = quizRepository.findById(id)
//                 .orElseThrow(() -> new RuntimeException("Quiz not found"));

//         // Save result into leaderboard
//         Leaderboard record = new Leaderboard();
//         record.setUser(user);
//         record.setQuiz(quiz);
//         record.setScore(score);
//         record.setTotalMarks(totalMarks);
//         leaderboardRepository.save(record);

//         model.addAttribute("quiz", quiz);
//         model.addAttribute("score", score);
//         model.addAttribute("totalMarks", totalMarks);

//         return "quiz-result"; // quiz-result.html
//     }

//     @PostMapping("/{id}/submit")
//     public String submitQuiz(@PathVariable Long id,
//             @RequestParam Map<String, String> answers,
//             HttpSession session,
//             Model model) {
//         User user = (User) session.getAttribute("user");
//         if (user == null) {
//             return "redirect:/login";
//         }

//         Quiz quiz = quizRepository.findById(id)
//                 .orElseThrow(() -> new RuntimeException("Quiz not found"));

//         int score = 0;
//         int totalMarks = quiz.getQuestions().size();

//         for (Question q : quiz.getQuestions()) {
//             String userAnswer = answers.get("q" + q.getId());
//             if (userAnswer != null && userAnswer.equalsIgnoreCase(q.getCorrectAnswer())) {
//                 score++;
//             }
//         }

//         // Save leaderboard
//         Leaderboard record = new Leaderboard();
//         record.setUser(user);
//         record.setQuiz(quiz);
//         record.setScore(score);
//         record.setTotalMarks(totalMarks);
//         leaderboardRepository.save(record);

//         model.addAttribute("quiz", quiz);
//         model.addAttribute("score", score);
//         model.addAttribute("totalMarks", totalMarks);

//         return "quiz-result";
//     }

// }
// package com.quiz.controller;

// import java.util.Map;

// import org.springframework.beans.factory.annotation.Autowired;
// import org.springframework.stereotype.Controller;
// import org.springframework.ui.Model;
// import org.springframework.web.bind.annotation.GetMapping;
// import org.springframework.web.bind.annotation.PathVariable;
// import org.springframework.web.bind.annotation.PostMapping;
// import org.springframework.web.bind.annotation.RequestMapping;
// import org.springframework.web.bind.annotation.RequestParam;

// import com.quiz.entity.Quiz;
// import com.quiz.entity.Result;
// import com.quiz.entity.User;
// import com.quiz.repo.LeaderboardRepository;
// import com.quiz.repo.QuizRepository;
// import com.quiz.repo.ResultRepository;

// import jakarta.servlet.http.HttpSession;

// @Controller
// @RequestMapping("/quiz")
// public class QuizController {

//     @Autowired
//     private QuizRepository quizRepository;

//     @SuppressWarnings("unused")
//     @Autowired
//     private LeaderboardRepository leaderboardRepository;

//     // Show quiz page
//     @GetMapping("/{id}")
//     public String showQuiz(@PathVariable Long id, Model model, HttpSession session) {
//         Quiz quiz = quizRepository.findById(id)
//                 .orElseThrow(() -> new RuntimeException("Quiz not found"));

//         User user = (User) session.getAttribute("user");
//         if (user == null) {
//             return "redirect:/login";
//         }

//         model.addAttribute("quiz", quiz);
//         return "take-quiz"; // start-quiz.html template
//     }

//     // Handle quiz submission
//     @Autowired
//     private ResultRepository resultRepository;

//     @PostMapping("/quiz/{id}/submit")
//     public String submitQuiz(@PathVariable Long id,
//             @RequestParam Map<String, String> answers,
//             HttpSession session,
//             Model model) {

//         Quiz quiz = quizRepository.findById(id).orElse(null);
//         if (quiz == null) {
//             return "redirect:/dashboard";
//         }

//         User user = (User) session.getAttribute("user");
//         if (user == null) {
//             return "redirect:/login";
//         }

//         int score = 0;
//         int total = quiz.getQuestions().size();

//         for (var question : quiz.getQuestions()) {
//             String selected = answers.get("answers[" + question.getId() + "]");
//             if (selected != null && selected.equalsIgnoreCase(question.getCorrectAnswer())) {
//                 score++;
//             }
//         }

//         // Save result
//         Result result = new Result();
//         result.setUser(user);
//         result.setQuiz(quiz);
//         result.setScore(score);
//         result.setTotalMarks(total);
//         resultRepository.save(result);

//         model.addAttribute("quiz", quiz);
//         model.addAttribute("score", score);
//         model.addAttribute("total", total);
//         model.addAttribute("user", user);

//         return "quiz-success";
//     }

// }